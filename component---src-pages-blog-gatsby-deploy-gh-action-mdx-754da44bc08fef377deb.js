"use strict";(self.webpackChunklock_dot_com=self.webpackChunklock_dot_com||[]).push([[9252],{27693:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return r},default:function(){return h}});var o=n(63366),a=(n(67294),n(64983)),i=n(32985),s=["components"],r={},l={_frontmatter:r},u=i.Z;function h(e){var t=e.components,n=(0,o.Z)(e,s);return(0,a.kt)(u,Object.assign({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",null,"Deploying Your Gatsby Website with Github Actions"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://docs.github.com/en/actions"},"Github actions")," are a great way to automate all of your code on Github.\nAnything that you plan on doing more than once can be automated and leaving\nmore time for the fun things."),(0,a.kt)("p",null,"Using the code walked through below you can reliably deploy your ",(0,a.kt)("a",{parentName:"p",href:"https://www.gatsbyjs.com/"},"Gatsby\nWebsite")," on Github pages as easily as you push to\na remote repository."),(0,a.kt)("h2",null,"Create a New Github Action"),(0,a.kt)("p",null,"Adding a workflow to your current repository can be done creating a new yaml\nfile and adding it to ",(0,a.kt)("inlineCode",{parentName:"p"},".github/workflows/<workflow-name\\>.yml"),". When\nthis file is pushed to your remote Github Repo you will be able to find a\nnew action on your repo action page."),(0,a.kt)("h2",null,"Build the workflow file"),(0,a.kt)("p",null,"You can find details of the breakdown below, or you can bottom of the page\nto view the full action file."),(0,a.kt)("h3",null,"Add a Workflow name"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"name: Gatsby Publish\n")),(0,a.kt)("h3",null,"Add the Workflow Trigger"),(0,a.kt)("p",null,"The trigger is the event that causes our Action to run. In this case I\nhave set it so that a push to my master branch will result in a new\nwebsite build. You can learn more about this in the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#on"},"workflow syntax docs"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"on:\n  push:\n    branches:\n      - master\n")),(0,a.kt)("h3",null,"Create Job"),(0,a.kt)("p",null,"This is the where we define what we want to run to the GitHub runner."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Set up job"),(0,a.kt)("p",{parentName:"li"},"The first task is to set up the machine for the GHA(GitHub Action) to run\non. You can view all machine options in the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idruns-on"},"documentation")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"  jobs:\n    build:\n      runs-on: ubuntu-latest\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Checkout the Repository"),(0,a.kt)("p",{parentName:"li"},"This step checks out the repository the action is in so you can access\nits code."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"  - uses: actions/checkout@v2\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Initialize Git User"),(0,a.kt)("p",{parentName:"li"},"This is necessary so that we can push to the deployment branch. The\ncheckout action handles branch permissions, so we don't have to worry about\nauthentication."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'  - name: Initialize GH User\n    run: |\n      git config user.name "GitHub Actions"\n      git config user.email "actions@github.com"\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Set Up and Install Node Modules"),(0,a.kt)("p",{parentName:"li"},"Using the package.json file in the websites root we will set up npm and\ninstall the needed modules to build our website."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"  - name: Set Node.js\n    uses: actions/setup-node@master\n    with:\n      node-version: '16'\n\n  - name: Install dependencies\n    run: npm install\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Build the Website"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"  - name: Build\n    run: npm run build\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Deploy the Website"),(0,a.kt)("p",{parentName:"li"},"First I copy over my CNAME file so that the website is\nserved from my custom domain. Next, and this is where it gets especially\nconfusing, I create a branch with the built website. To do this I commit\nthe built website to the current branch and then use subtree to split the\n'public' subdirectory into its own branch called 'gh-pages'. As gh-pages\nis the branch I serve my website from I then push this branch to origin\nwhere is published to the world"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'  - name: Deploy\n    run: |\n      # Add in the correct CNAME - Optional\n      echo "<your-domain>" > public/CNAME\n\n      # Commit the build then use \'git subtree\' to create a branch with just the public contents\n      git add public -f\n      git commit -m "Build Production Website"\n      git checkout -b gh-pages `git subtree split --prefix public master`\n\n      # Push to Production\n      git push --set-upstream origin gh-pages --force\n')))),(0,a.kt)("h2",null,"Using the Action"),(0,a.kt)("p",null,"Using this action now can spend less time deploying and more time developing!\nYou can find the past runs for this action for this website in my\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/CannonLock/Personal-Website/actions"},"repository"),", and\nyou can find the actual file ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/CannonLock/Personal-Website/blob/master/.github/workflows/deploy-website.yml"},"there as well"),"."),(0,a.kt)("h2",null,"Gatsby Deployment with GitHub Actions Full Code"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'name: Gatsby Publish\n\non:\n    push:\n        branches:\n            - master\n\njobs:\n    build:\n        runs-on: ubuntu-latest\n        steps:\n            -   uses: actions/checkout@v2\n\n            -   name: Initialize GH User\n                run: |\n                    git config user.name "GitHub Actions"\n                    git config user.email "actions@github.com"\n\n            -   name: Set Node.js\n                uses: actions/setup-node@master\n                with:\n                    node-version: \'16\'\n\n            -   name: Install dependencies\n                run: npm install\n\n            -   name: Build\n                run: npm run build\n\n            -   name: Deploy\n                run: |\n                    # Add in the correct CNAME - Optional\n                    echo <your-domain> > public/CNAME\n\n                    # Commit the build then use \'git subtree\' to create a branch with just the public contents\n                    git add public -f\n                    git commit -m "Build Production Website"\n                    git checkout -b gh-pages `git subtree split --prefix public master`\n\n                    # Push to Production\n                    git push --set-upstream origin gh-pages --force\n')))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-blog-gatsby-deploy-gh-action-mdx-754da44bc08fef377deb.js.map